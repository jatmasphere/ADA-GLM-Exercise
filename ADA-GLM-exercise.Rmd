---
title: "White-throated Sparrow Morphs"
output: 
  html_document:
    df_print: paged
---
Beauchamp et al., 2020. Data from: Stopover refueling, movement, and departure decisions in the White-throated Sparrow: the influence of intrinsic and extrinsic factors during spring migration, Dryad, Dataset, https://doi.org/10.5061/dryad.v6wwpzgsv

White-throated Sparrows are a species of bird that exhibit 2 different color morphs within the species: a Tan-striped morph (top) and a White-striped morph (bottom). These morphs are a result of a large chromosomal inversion, which not only alter the coloration in the feathers, but also alter some behavioral characteristics, such as aggressiveness. 

```{r setup, include=FALSE}
library(janitor)
library(ggplot2)
library(arm)
library(ggfortify)
library(AICcmodavg)
library(grid)
```

```{r cleaning up data, include=FALSE}
WTSPdata <- read.csv("data/WTSP_data_2020.csv")
WTSPdata <- na.omit(WTSPdata) 

```

![Tan-striped color morph](images/tanstripe.jpeg){width=50%}
![White-striped color morph](images/whitestripe.jpeg){width=50%}

The white-striped sparrows have been shown to display more aggressive and territorial behaviors, over the tan-striped individuals, including defending food sources like feeders (Kopachena and Falls, 1993). This may imply that white-striped individuals will have a higher fat weight than their more timid tan-striped counterparts.

In order to analyze this, I ran a binomial generalized-mixed model to look at the relationship between the amount of fat each bird has and the color morph of the bird.

```{r visualizing raw data}
ggplot(WTSPdata, aes(fat, morph)) +
  geom_point() +
  geom_smooth() +
  xlab ("Fat (grams)") +
  ylab ("Color Morph") +
  labs(title="Raw Fit: 1 = White morph, 0 = Tan morph")

```

```{r GLM}
fit.1 <- glm(morph~fat, data=WTSPdata, binomial(link="logit"))

```

```{r}
x <- predict(fit.1)
y <- resid(fit.1)
binnedplot(x, y)

```
```{r}
coef(fit.1)
confint(fit.1)
```

```{r}
ggplot(WTSPdata, aes(fat, morph)) +
  geom_point() +
  geom_smooth(method="glm", method.args=list(family="binomial"(link="logit"))) + 
  xlab ("Fat (grams)") +
  ylab ("Color Morph")
```

```{r}
summary(fit.1)
```

In this case, the GLM of the binary White-throated Sparrow data reveals no effect of color morph on the amount of fat a bird may have.

In the model Pr(Bush support) = logit^-1(-1.40 + 0.33 Â· income), we can divide 0.33/4 to get 0.08: a difference of 1 in income category corresponds to no more than an 8% positive difference in the probability of supporting Bush.


---
title: "Point-Count Data"
output:
  html_document:
    df_print: paged
---

Intro

```{r cleaning up data, include=FALSE}
GRSPdata <- read.csv("data/GRSP_data.csv")
GRSP.glm <- glm(grsp ~ ta_800, data = GRSPdata, family = poisson)
```

```{r cancer plot, message=FALSE, warning=FALSE, fig.width=4, fig.height=4}
ggplot(GRSPdata, aes(ta_800, grsp)) +
  geom_point(size=3) +
  #geom_smooth (method=lm, color="red") + #if you wanted to see the gaussian/identity fit
  stat_smooth(method = glm, method.args = list(family = poisson(link = "log"))) +
  labs(title="GLM, poisson distributed count data") +
  xlab ("Size of grassland (ha)") +
  ylab ("No. of Grasshopper Sparrows Detected")
```
```{r}
grsplink.glm <- glm(grsp ~ ta_800, data = GRSPdata, family = poisson(link = log))
#this is the same model as above, but all defaults are explicitly reported rather than assumed
```

```{r cancer glm model, fig.width=6, fig.height=6}
autoplot(grsplink.glm)
```
```{r Look at model}
anova(grsplink.glm)
```
Because the model is fit with maximum likelihood, we get deviance table. Deviance explained by distance is 2.84 units, unaccounted deviance is 92 and the total deviance (distance + unaccounted) is 149.
```{r}
summary(grsplink.glm)
```

What does the report tell us?

# look at residual deviance to see if poisson is a good fit

P-value of 0.09 - no sig effect of distance

* coefficient tests: **Wald z-value** to tell us whether the estimate is significantly different from zero. Ratio of the estimate/SE (for body size -0.006/0.004 = -1.67).

* The model is over dispersed (146.6/92.0=).

* AIC: to be used in comparing 'fits' of different nested models (more on this later).

* **We transform the coefficient to make a prediction**; remember that the GLM is predicting the natural logarithm of cancer likelihood over distance. If we want to know how many cancer cases are predicted, we must account for what the link function did.

What is the expected probability of cancer for someone who lives 10km away? ANSWER=e^(-2.422+0.541*5), or 1 and 0.7 for 100km.

```{r Exponentiate prediction}
exp(-2.422+0.541*5)
```


```{r}
ggplot(GRSPdata, aes(x = ta_800, y = grsp)) +
geom_point() +
geom_smooth(method = "glm", method.args=list(family="quasipoisson"(link="identity")))+
#geom_smooth(span = 1, colour = "red", se = FALSE) +
xlab("Distance") + ylab("Number of cancer cases") +
  ggtitle("Linear Model = Gaussian Error Structure, Identity Link")
#note negative prediction of fitness below ~3kg.

ggplot(GRSPdata, aes(x = ta_800, y = grsp)) +
geom_point() +
geom_smooth(method="glm", method.args=list(family="poisson"(link="log"))) +
xlab("Distance") + ylab("Number of cancer cases") +
  ggtitle("Linear Model = Poisson Error Structure, Log Link")
```

