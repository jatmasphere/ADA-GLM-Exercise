---
title: "White-throated Sparrow Morphs"
output: 
  html_document:
    df_print: paged
---
Beauchamp et al., 2020. Data from: Stopover refueling, movement, and departure decisions in the White-throated Sparrow: the influence of intrinsic and extrinsic factors during spring migration, Dryad, Dataset, https://doi.org/10.5061/dryad.v6wwpzgsv

White-throated Sparrows are a species of bird that exhibit 2 different color morphs within the species: a Tan-striped morph (top) and a White-striped morph (bottom). These morphs are a result of a large chromosomal inversion, which not only alter the coloration in the feathers, but also alter some behavioral characteristics, such as aggressiveness. 

```{r setup, include=FALSE}
library(janitor)
library(ggplot2)
library(arm)
library(ggfortify)
library(AICcmodavg)
library(grid)
```

```{r cleaning up data, include=FALSE}
WTSPdata <- read.csv("data/WTSP_data_2020.csv")
WTSPdata <- na.omit(WTSPdata) 

```

![Tan-striped color morph](images/tanstripe.jpeg){width=60%}
![White-striped color morph](images/whitestripe.jpeg){width=60%}

The white-striped sparrows have been shown to display more aggressive and territorial behaviors, over the tan-striped individuals, including defending food sources like feeders (Kopachena and Falls, 1993). This may imply that white-striped individuals will have a higher fat weight than their more timid tan-striped counterparts.

In order to analyze this, I ran a binomial generalized-mixed model to look at the relationship between the amount of fat each bird has and the color morph of the bird.

First, here is a quick look at the raw fit of the data on a binomial graph:

```{r visualizing raw data}
ggplot(WTSPdata, aes(fat, morph)) +
  geom_point() +
  geom_smooth() +
  xlab ("Fat (grams)") +
  ylab ("Color Morph") +
  labs(title="Raw Fit: 1 = White morph, 0 = Tan morph")

ggplot(WTSPdata, aes(wing_length, sex)) +
  geom_point() +
  geom_smooth() +
  xlab ("Wing length (mm)") +
  ylab ("Sex") +
  labs(title="Raw Fit: 1 = Male, 0 = Female")
```
Running the data through a GLM:

```{r GLM}
fit.1 <- glm(morph~fat, data=WTSPdata, binomial(link="logit"))
fit.2 <- glm(sex~wing_length, data=WTSPdata, binomial(link="logit"))
```

Since we can't use the ratio of the residual deviance to residual DF to look for overdispersion as we do with binomial counts

```{r}
x <- predict(fit.1)
y <- resid(fit.1)
binnedplot(x, y)

x <- predict(fit.2)
y <- resid(fit.2)
binnedplot(x, y)

```
```{r}
coef(fit.1)
confint(fit.1)

coef(fit.2)
confint(fit.2)
```
The logistic curve is linear on the logit scale and the coefficients are the regression intercept (0.14) and slope (0.02) of this line. 
Checking the assumption that the ratio of the residual deviance to the residual DF (dispersion parameter) is approximately 1:1. It is a little higher based on the summary() output table: (196.7/140=1.4)

```{r}
summary(fit.1)
summary(fit.2)
```

I used the "family" argument to specify a binomial distribution (for which the logistic is the default link function). The logistic link function and binomial distribution will take account of the properties and constraints on the pattern of the mean and variance for binomial count data.

```{r}
ggplot(WTSPdata, aes(fat, morph)) +
  geom_point() +
  geom_smooth(method="glm", method.args=list(family="binomial"(link="logit"))) + 
  xlab ("Fat (grams)") +
  ylab ("Color Morph")

ggplot(WTSPdata, aes(wing_length, sex)) +
  geom_point() +
  geom_smooth(method="glm", method.args=list(family="binomial"(link="logit"))) + 
  xlab ("Wing Length (mm)") +
  ylab ("Sex (F = 0, M = 1")
```

In this case, the GLM of the binary White-throated Sparrow data suggests no correlation between color morph on the amount of fat a bird may have.

---
title: "Point-Count Data"
output:
  html_document:
    df_print: paged
---

Intro

```{r cleaning up data 2, include=FALSE}
GRSPdata <- read.csv("data/GRSP_data.csv")
GRSP.glm <- glm(grsp ~ ta_800, data = GRSPdata, family = poisson)
```

```{r grsp plot, message=FALSE, warning=FALSE}
ggplot(GRSPdata, aes(ta_800, grsp)) +
  geom_point(size=2) +
  #geom_smooth (method=lm, color="red") + #if you wanted to see the gaussian/identity fit
  stat_smooth(method = glm, method.args = list(family = poisson(link = "log"))) +
  labs(title="GLM, poisson distributed count data") +
  xlab ("Size of grassland (ha)") +
  ylab ("No. of Grasshopper Sparrows Detected")

```
```{r}
grsplink.glm <- glm(grsp ~ ta_800, data = GRSPdata, family = poisson(link = log))
#this is the same model as above, but all defaults are explicitly reported rather than assumed
```

```{r grsp glm model, fig.width=6, fig.height=6}
autoplot(grsplink.glm)
```
```{r Look at model 2}
anova(grsplink.glm)
```
Because the model is fit with maximum likelihood, we get deviance table. Deviance explained by distance is 2.84 units, unaccounted deviance is 92 and the total deviance (distance + unaccounted) is 149.
```{r}
summary(grsplink.glm)
```

What does the report tell us?

# look at residual deviance to see if poisson is a good fit

P-value of 0.09 - no sig effect of distance

* coefficient tests: **Wald z-value** to tell us whether the estimate is significantly different from zero. Ratio of the estimate/SE (for body size -0.006/0.004 = -1.67).

* The model is over dispersed (146.6/92.0=).

* AIC: to be used in comparing 'fits' of different nested models (more on this later).

* **We transform the coefficient to make a prediction**; remember that the GLM is predicting the natural logarithm of cancer likelihood over distance. If we want to know how many cancer cases are predicted, we must account for what the link function did.

What is the expected probability of cancer for someone who lives 10km away? ANSWER=e^(-2.422+0.541*5), or 1 and 0.7 for 100km.

```{r Exponentiate prediction 2}
exp(-2.422+0.541*5)
```


```{r}
ggplot(GRSPdata, aes(x = ta_800, y = grsp)) +
geom_point() +
geom_smooth(method="glm", method.args=list(family="poisson"(link="log"))) +
xlab("Distance") + ylab("Number of cancer cases") +
  ggtitle("Linear Model = Poisson Error Structure, Log Link")
```

